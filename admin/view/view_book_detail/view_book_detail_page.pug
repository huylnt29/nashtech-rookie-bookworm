extends ../global_layout.pug

block content   
     include edit_book_modal.pug
     include add_author_modal.pug
     include change_category_modal.pug
     include change_publisher_modal.pug
     include add_image_handler.pug
     include ../view_book_list/delete_book_modal.pug

     +edit_book_modal("name", book.name)
     +edit_book_modal("description", book.description)
     +add_author_modal(otherAuthors)
     +change_category_modal(otherCategories)
     +change_publisher_modal(otherPublishers)

     div
          div.flex.justify-between.items-center
               div.flex
                    i(class="material-icons w-8") book_5
                    p(class='font-bold text-xl text-slate-900 uppercase') #{book.name}
               +primary_button("Delete", `openDeleteModal(${book.id})`, "red")
          div.h-4
          div.flex.items-center
               div.grow
               p(class='font-bold text-lg text-gray-600 text-center') Images
               div.grow
               +secondary_button("Add", `openFileUploader()`, "orange")
          div.h-3
          div(class='bg-white p-8 shadow-lg shadow-slate-200 rounded-2xl')
               if book.imageUrls.length > 0
                    div.grid.grid-cols-5.place-items-center
                         each imageUrl in book.imageUrls
                              img(src=imageUrl).max-h-48.rounded-xl
               else 
                    +announcement(
                         '../illustration_no_data.svg', 
                         'You have not inserted any image.'
                    )
          
          div.h-8
          p(class='font-bold text-lg text-gray-600 text-center') Basic information
          div.h-3
          div(class='bg-white py-3 px-8 shadow-lg shadow-slate-200 rounded-2xl')
               +row_text('id', book.id)
               +row_text('name', book.name, `openEditModal("name")`)
               +row_text('publisher', book.publisher.name, "openChangePublisherModal()", `/publisher/${book.publisher.id}`)
               +row_text('category', book.category.name, "openChangeCategoryModal()", `/category/${book.category.id}`)
               +row_text('created at', book.createdAt)
               +row_text('updated at', book.updatedAt)
          div.h-8
          div.flex.items-center
               div.grow
               p(class='font-bold text-lg text-gray-600 text-center') Authors
               div.grow
               +secondary_button("Add", `openAddAuthorModal()`, "orange")
          div.h-3
          div(class='bg-white p-8 shadow-lg shadow-slate-200 rounded-2xl')
               if book.authors.length > 0
                    table.table.w-full
                         thead(class='table-header-group bg-slate-100')
                              tr.table-row
                                   th(class="table-cell text-left p-3") ID
                                   th(class="table-cell text-left") NAME
                                   th(class="table-cell text-left w-8")          
                         tbody.table-row-group
                              each author in book.authors
                                        tr(class="table-row hover:bg-slate-50 hover:cursor-pointer group")
                                             td.table-cell.p-3(onclick=``) #{author.id}
                                             td.table-cell(onclick=``) #{author.name}
                                             td.table-cell
                                                  i(
                                                       class="material-icons hidden group-hover:block w-4", 
                                                       onclick=`removeAuthor(${author.id})`
                                                  ) delete
               else 
                    +announcement(
                         '../illustration_no_data.svg', 
                         'You have not associated any authors with this book'
                    )

          div.h-8
          div.flex.items-center
               div.grow
               p(class='font-bold text-lg text-gray-600 text-center') Description
               div.grow
               +secondary_button("Edit", `openEditModal("description")`, "orange")
          div.h-3
          div(class='bg-white p-8 shadow-lg shadow-slate-200 rounded-2xl')
               p(class='text-slate-900 whitespace-pre-wrap') #{book.description}
          div.h-24

     script(type='text/javascript').
          const removeAuthor = (authorId) => {
               const id = location.href.split('/').at(-1)
               axios.delete(`/book/${id}/author/${authorId}`)
               .then(() => location.reload())
          }
