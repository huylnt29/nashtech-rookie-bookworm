extends ../global_layout.pug

block content   
     div
          div.flex.justify-between.items-center
               div.flex
                    i.material-icons.w-8 batch_prediction
                    p(class='font-bold text-xl text-slate-900') #{batch.book.name} - Batch #{batch.id}
               button(
                    class='bg-red-900 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-xl', 
                    onclick=`openDeleteModal(${batch.id})`
               ) Delete

          div.h-4
          div.flex.justify-between.gap-12
               div(class="basis-2/5")
                    div.flex.items-center
                         div.w-2.bg-slate-600.mr-3.rounded-xl ''
                         p(class='font-bold text-lg text-gray-600 text-center') Book
                    div.h-3
                    div.bg-white.shadow-lg.shadow-slate-200.rounded-2xl
                         img(src=batch.book.imageUrls[0]).rounded-t-xl.rounded-tl-xl.rounded-tr-xl.w-full.h-56.object-cover
                         div.py-3.px-8
                              +row_text('id', batch.book.id)
                              +row_text('name', batch.book.name)
               div(class="basis-3/5")
                    div.flex.items-center
                         div.w-2.bg-slate-600.mr-3.rounded-xl ''
                         p(class='font-bold text-lg text-gray-600 text-center') Primary information
                    div.h-3
                    div.bg-white.py-3.px-8.shadow-lg.shadow-slate-200.rounded-2xl.divide-y.divide-dashed
                         +row_text('id', batch.id)
                         div
                              +row_text('sold quantity', batch.soldQuantity)
                              +row_text('initial quantity', batch.initialQuantity)
                         div
                              +row_text('price to sell', batch.price)
                              +row_text('original price', batch.originalPrice)
                         div
                              +row_text('created at', batch.createdAt.toLocaleString())
                              +row_text('updated at', batch.updatedAt.toLocaleString())

          div.h-8
          div.flex.items-center
               div.w-2.bg-slate-600.mr-3.rounded-xl ''
               p(class='font-bold text-lg text-gray-600 text-center') Associated discounts
          div.h-3
          div.bg-white.py-3.px-8.shadow-lg.shadow-slate-200.rounded-2xl
               if batch.discounts.length > 0
                    table.table.w-full
                         thead.table-header-group.bg-slate-100
                              tr.table-row
                                   th.table-cell.text-left.p-3 ID
                                   th.table-cell.text-left MIN QUANTITY
                                   th.table-cell.text-left MAX QUANTITY
                                   th.table-cell.text-left PERCENTAGE (%)
                                   th.table-cell.text-left.w-8        
                         tbody(class="table-row-group")
                              each discount in batch.discounts
                                        tr(class="table-row hover:bg-slate-50 hover:cursor-pointer group")
                                             td.table-cell.p-3(onclick=`navigateToDiscountDetailPage(${discount.id})`) #{discount.id}
                                             td.table-cell(onclick=`navigateToDiscountDetailPage(${discount.id})`) #{discount.minQuantity}
                                             td.table-cell(onclick=`navigateToDiscountDetailPage(${discount.id})`) #{discount.maxQuantity}
                                             td.table-cell(onclick=`navigateToDiscountDetailPage(${discount.id})`) #{discount.percentage * 100}
                                             td.table-cell(class="table-cell")
                                                  i(class="material-icons hidden group-hover:block w-4", onclick=`removeDiscount(${discount.id})`) delete
               else 
                    +announcement(
                         '../illustration_no_data.svg', 
                         'You have not associated any discounts with this batch'
                    )
               
          div.h-24

     script(type='text/javascript').
          const navigateToDiscountDetailPage = (id) => location.href = `/discount/${id}`
          const removeDiscount = (discountId) => {
               const id = location.href.split('/').at(-1)
               axios.delete(`/batch/${id}/author/${discountId}`)
               .then(() => location.reload())
          }
     
     include ../view_batch_list/delete_batch_modal.pug
